# Copilot / AI Agent Instructions for Expense Split App

Purpose: quick, actionable guidance so AI agents can modify and extend this Expo + React Native project safely.

- Big picture: This is an Expo app using `expo-router` for filesystem routing and React Query for data fetching. Root layout is in [src/app/\_layout.tsx](src/app/_layout.tsx#L1-L120) which composes providers: `QueryClientProvider`, `BottomSheetProvider`, `KeyboardProvider`, and `FontGuard`.

- Key workflows:
  - Start dev: see `scripts` in [package.json](package.json#L1-L60): use `npm run start` (runs `expo start`) or `npm run android` / `npm run ios` / `npm run web`.
  - Formatting & linting: use `npm run format` (`biome format src --write`) and `npm run lint` (`biome check src`).

- Project conventions and patterns:
  - Path alias: `@/*` maps to `./src/*` (see [tsconfig.json](tsconfig.json#L1-L40)). Use `@/` imports for project modules.
  - Routing: Keep page components under `src/app/`. Files correspond to routes (e.g., `src/app/index.tsx`). Do not move routing files out of this tree.
  - Providers in root layout: Global providers are mounted in `_layout.tsx`. Add new global context/providers there to ensure they're available to all routes.
  - Bottom-sheet state: There's a lightweight provider and hook at [src/hooks/use-bottom-sheets.tsx](src/hooks/use-bottom-sheets.tsx#L1-L80). Use `useBottomSheet()` to read/set `isBottomSheetOpen` to coordinate `Stack` content overflow behavior.
  - Font loading: `FontGuard` at [src/guards/font-guard.tsx](src/guards/font-guard.tsx#L1-L40) is intentionally minimal. Do not assume fonts are automatically loaded—add explicit font-loading there if needed.

- API and auth flow:
  - API client: `src/libs/apiClient.ts` injects `Authorization: Bearer <token>` from storage on each request. See implementation for the interceptor pattern: [src/libs/apiClient.ts](src/libs/apiClient.ts#L1-L40).
  - Token storage: Access tokens are stored with AsyncStorage helpers in [src/services/storage/token-storage.ts](src/services/storage/token-storage.ts#L1-L80). Use these helpers when reading/updating tokens.

- Native & build notes:
  - Native libraries present include `@gorhom/bottom-sheet`, `react-native-reanimated`, gesture handler, and native async storage. When making native-level changes, run appropriate Expo tooling and ensure Metro config (if added) supports SVG/transformers.

- When editing code:
  - Preserve generated comments like "Generated by skill" — they indicate files scaffolded by automation.
  - Small UI changes should be added under `src/components/` and reused across pages.
  - Prefer updating provider logic in `_layout.tsx` rather than sprinkling global state providers in page files.

- Helpful files to inspect when changing behavior:
  - Root layout: [src/app/\_layout.tsx](src/app/_layout.tsx#L1-L120)
  - API client: [src/libs/apiClient.ts](src/libs/apiClient.ts#L1-L40)
  - Token storage: [src/services/storage/token-storage.ts](src/services/storage/token-storage.ts#L1-L80)
  - Hooks: [src/hooks/use-bottom-sheets.tsx](src/hooks/use-bottom-sheets.tsx#L1-L80)
  - Formatting & scripts: [package.json](package.json#L1-L60)

If anything here is unclear or you'd like me to include more examples (e.g., react-query usage, tests, or component patterns), tell me which area to expand. I will iterate on this file.

## Estrutura e Convenções de Componentes (adicional)

- Estrutura de pastas recomendada (exemplo simples):
  - `src/components/` — componentes UI reaproveitáveis (cada componente em sua própria pasta)
  - `src/screens/` — páginas/rotas que vivem em `src/app/` (use `src/app/` para rotas do `expo-router`)
  - `src/hooks/` — hooks customizados (ex.: `use-bottom-sheets.tsx`)
  - `src/libs/` — clientes e utilitários de infra (ex.: `apiClient.ts`, `react-query.ts`)
  - `src/services/` — integração com armazenamento, auth e APIs (ex.: `services/storage/token-storage.ts`)

- Nomeclatura de arquivos e pastas:
  - Use `lowercase-com-kebab` para arquivos e pastas: ex.: `user-card.tsx`, `use-modal.ts`.
  - Sempre `named exports` em vez de `default export`.
  - Arquivos de estilo/tema: `src/styles/global.css`.

- Regras para criação de componentes React Native (resumido):
  - Arquivo por componente em `src/components/<component-name>/index.tsx`.
  - Typescript `strict`: exporte tipos via `export interface` quando necessário.
  - Não usar `React.FC` nem `any`.
  - Use `clsx` para condicionais de classe e `twMerge` para mesclar classes Tailwind.
  - Siga a convenção de classes do projeto (Nativewind + Tailwind v4 preview).
  - Props spread no final: `{...props}`.
  - Botões de ícone precisam de `aria-label`.

- Exemplo mínimo de componente (padrão do projeto):

```tsx
import { TouchableOpacity, Text } from "react-native";
import clsx from "clsx";
import { twMerge } from "tailwind-merge";

export interface ButtonProps extends React.ComponentProps<
  typeof TouchableOpacity
> {
  variant?: "filled" | "outlined";
}

export function Button({
  variant = "filled",
  children,
  className,
  ...props
}: ButtonProps) {
  return (
    <TouchableOpacity
      className={twMerge(
        "h-12 rounded-full p-3",
        clsx({ "bg-primary": variant === "filled" }),
        className,
      )}
      {...props}
    >
      <Text>{children}</Text>
    </TouchableOpacity>
  );
}
```

- Bibliotecas core (use como referência e prefira estas ao adicionar novas):
  - `expo`, `expo-router`, `expo-font`, `expo-splash-screen`
  - `react`, `react-native`, `react-native-reanimated`, `react-native-gesture-handler`
  - `nativewind`, `tailwind-merge`, `clsx`
  - `@tanstack/react-query`, `axios`
  - `@react-native-async-storage/async-storage`

- Fluxo obrigatório após geração de código:
  - Sempre rode format e lint após criar/alterar arquivos gerados por IA para garantir padronização e detectar problemas.

Execute:

```bash
npm run format
npm run lint
```

## Observações finais

- Preserve comentários gerados (ex.: "Generated by skill").
